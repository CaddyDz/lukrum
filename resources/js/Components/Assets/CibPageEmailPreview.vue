<template>
    <div class="flex mt-3">
        <div style="box-shadow: 0px 1px 11px 0px #e4e4e4;">
            <table align="left" border="0" cellpadding="0" cellspacing="0" width="100%">
                <tbody>
                <tr>
                    <!-- added padding here -->
                    <td class="content_padding" style="border:0px;padding : 10px; ">
                    <!-- end of comment -->
                    <table border="0" cellpadding="0" cellspacing="0" width="100%">
                        <tbody>
                        <tr>
                            <td align="left" class="header" valign="top">
                            <table cellpadding="0" cellspacing="0" width="100%" role="presentation"
                                style="background-color: transparent; min-width: 100%; border-top: 0px; border-right: 0px; border-bottom: 1px solid transparent; border-left: 0px; "
                                class="slot-styling">
                                <tbody>
                                <tr>
                                    <td style="padding: 0px; " class="slot-styling camarker-inner">
                                    <table cellpadding="0" cellspacing="0" width="100%" role="presentation"
                                        style="background-color: transparent; min-width: 100%; "
                                        class="stylingblock-content-wrapper">
                                        <tbody>
                                        <tr>
                                            <td style="padding: 0px; " class="stylingblock-content-wrapper camarker-inner">
                                            <table width="100%" cellspacing="0" cellpadding="0" role="presentation">
                                                <tbody>
                                                <tr>
                                                    <td align="center"><img data-assetid="18979"
                                                        src="http://image.marketing.wundermanthompson.com/lib/fe45157175640478751671/m/1/TestClientHeader.png"
                                                        alt="" width="1200"
                                                        style="display: block; text-align: center; padding: 0px; height: auto; width: 100%;">
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            </td>
                        </tr>
                        <tr>
                            <td align="left" class="" valign="top">
                            <table cellpadding="0" cellspacing="0" width="100%" role="presentation"
                                style="background-color: transparent; min-width: 100%; border-top: 0px; border-right: 0px; border-bottom: 1px solid transparent; border-left: 0px; "
                                class="slot-styling">
                                <tbody>
                                <tr>
                                    <td style="padding: 0px 0px 10px; " class="slot-styling camarker-inner">
                                    <table cellpadding="0" cellspacing="0" width="100%" role="presentation"
                                        style="background-color: transparent; min-width: 100%; "
                                        class="stylingblock-content-wrapper">
                                        <tbody>
                                        <tr>
                                            <td style="padding: 20px 0px 0px; " class="stylingblock-content-wrapper camarker-inner">
                                            <table style="width: 100%;" cellspacing="0" cellpadding="0">
                                                <tbody>
                                                <tr>
                                                    <td>
                                                    <table style="width: 100%;" cellspacing="0" cellpadding="0">
                                                        <tbody>
                                                        <tr>
                                                            <td class="responsive-td" style="width: 100%;" valign="top">
                                                            <table cellpadding="0" cellspacing="0" width="100%"
                                                                role="presentation" style="text-align: left; min-width: 100%; "
                                                                class="stylingblock-content-wrapper">
                                                                <tbody>
                                                                <tr>
                                                                    <td class="stylingblock-content-wrapper camarker-inner"
                                                                    align="left">
                                                                    <table role="presentation" width="100%" cellspacing="0"
                                                                        cellpadding="0">
                                                                        <tbody>
                                                                        <tr>
                                                                            <td align="center"><img data-assetid="22620"
                                                                                :src="logo"
                                                                                alt=""
                                                                                style="display: block; width: 100%; height: auto; padding: 0px; text-align: center;"
                                                                                width="100%"></td>
                                                                        </tr>
                                                                        </tbody>
                                                                    </table>
                                                                    </td>
                                                                </tr>
                                                                </tbody>
                                                            </table>
                                                            <table cellpadding="0" cellspacing="0" width="100%"
                                                                role="presentation"
                                                                style="text-align: left; background-color: transparent; min-width: 100%; "
                                                                class="stylingblock-content-wrapper">
                                                                <tbody>
                                                                <tr>
                                                                    <td style="padding: 0px 10px 10px; "
                                                                    class="stylingblock-content-wrapper camarker-inner"
                                                                    align="left">
                                                                    <h1
                                                                        style="font-family:Arial, helvetica, sans-serif;font-size:25px;color:#202020;line-height:115%;font-weight:normal;font-style:normal; padding: 8px 0px; margin-bottom: 10px;">
                                                                        <b ref="introDiv" v-html="intro"></b></h1>
                                                                    <div>
                                                                        <span style="font-size:14px;"><span
                                                                            style="font-family:Arial,Helvetica,sans-serif;" v-text="bodyText"></span></span><br>
                                                                        <br>
                                                                        <u><span style="font-size:16px;"><b><a alias=""
                                                                                conversion="false" data-linkto="https://"
                                                                                href="https://www.fastcompany.com/90628937/degrees-new-deodorant-is-designed-with-disabled-people-in-mind"
                                                                                style="color:#000000;text-decoration:underline;"
                                                                                title="" v-text="cta"></a></b></span></u>
                                                                    </div>
                                                                    </td>
                                                                </tr>
                                                                </tbody>
                                                            </table>
                                                            <table cellpadding="0" cellspacing="0" width="100%"
                                                                role="presentation" class="stylingblock-content-wrapper"
                                                                style="min-width: 100%; ">
                                                                <tbody>
                                                                <tr>
                                                                    <td class="stylingblock-content-margin-cell"
                                                                    style="padding: 0px 0px 10px; ">
                                                                    <table cellpadding="0" cellspacing="0" width="100%"
                                                                        role="presentation"
                                                                        style="background-color: transparent; min-width: 100%; "
                                                                        class="stylingblock-content-wrapper">
                                                                        <tbody>
                                                                        <tr>
                                                                            <td style="padding: 0px; "
                                                                            class="stylingblock-content-wrapper camarker-inner">
                                                                            <table class="socialshare-wrapper" width="100%"
                                                                                cellspacing="0" cellpadding="0">
                                                                                <tbody>
                                                                                <tr>
                                                                                    <td align="left">
                                                                                    <table cellspacing="0" cellpadding="0"
                                                                                        align="left">
                                                                                        <tbody>
                                                                                        <tr>
                                                                                            <td align="left">
                                                                                            <!--[if mso]><table border="0" cellspacing="0" cellpadding="0"><tr><td style="padding-right:10px;"><![endif]-->
                                                                                            <table class="socialshare-innertable"
                                                                                                style="display: inline-block">
                                                                                                <tbody>
                                                                                                <tr>
                                                                                                    <td style="padding:5px 10px"><a
                                                                                                        href="https://www.facebook.com/WundermanThompson/posts/3983211211740277"
                                                                                                        alias="facebook follow"><img
                                                                                                        src="https://image.s4.exct.net/lib/fe911573736c007d7d/m/2/24b84e22-8d38-4d6c-98db-80812ca4de5f.png"
                                                                                                        alt="Facebook"
                                                                                                        style="display: block;; width: 24px !important; height: 24px !important"
                                                                                                        width="24"
                                                                                                        height="24"></a>
                                                                                                    </td>
                                                                                                </tr>
                                                                                                </tbody>
                                                                                            </table>
                                                                                            <!--[if mso]></td><td style="padding-right:10px;"><![endif]-->
                                                                                            <table class="socialshare-innertable"
                                                                                                style="display: inline-block">
                                                                                                <tbody>
                                                                                                <tr>
                                                                                                    <td style="padding:5px 10px"><a
                                                                                                        href="https://twitter.com/WunThompson/status/1387036551117524995"
                                                                                                        alias="twitter follow"><img
                                                                                                        src="https://image.s4.exct.net/lib/fe911573736c007d7d/m/2/a14c2439-7025-4aab-a01f-423077193687.png"
                                                                                                        alt="Twitter"
                                                                                                        style="display: block;; width: 24px !important; height: 24px !important"
                                                                                                        width="24"
                                                                                                        height="24"></a>
                                                                                                    </td>
                                                                                                </tr>
                                                                                                </tbody>
                                                                                            </table>
                                                                                            <!--[if mso]></td><td style="padding-right:10px;"><![endif]-->
                                                                                            <table class="socialshare-innertable"
                                                                                                style="display: inline-block">
                                                                                                <tbody>
                                                                                                <tr>
                                                                                                    <td style="padding:5px 10px"><a
                                                                                                        href="https://www.instagram.com/p/COJFWIqrENJ/"
                                                                                                        alias="instagram follow"><img
                                                                                                        src="https://image.s4.exct.net/lib/fe911573736c007d7d/m/2/11a4a1aa-4e8a-432a-8f1f-f8898206da39.png"
                                                                                                        alt="Instagram"
                                                                                                        style="display: block;; width: 24px !important; height: 24px !important"
                                                                                                        width="24"
                                                                                                        height="24"></a>
                                                                                                    </td>
                                                                                                </tr>
                                                                                                </tbody>
                                                                                            </table>
                                                                                            <!--[if mso]></td><td><![endif]-->
                                                                                            <table class="socialshare-innertable"
                                                                                                style="display: inline-block">
                                                                                                <tbody>
                                                                                                <tr>
                                                                                                    <td style="padding:5px 10px"><a
                                                                                                        href="https://www.linkedin.com/feed/update/urn:li:activity:6792542908290605056"
                                                                                                        alias="linkedin follow"><img
                                                                                                        src="https://image.s4.exct.net/lib/fe911573736c007d7d/m/2/44cae9a3-eba9-48b9-911b-705f7777cd0e.png"
                                                                                                        alt="LinkedIn"
                                                                                                        style="display: block;; width: 24px !important; height: 24px !important"
                                                                                                        width="24"
                                                                                                        height="24"></a>
                                                                                                    </td>
                                                                                                </tr>
                                                                                                </tbody>
                                                                                            </table>
                                                                                            <!--[if mso]></td></tr></table><![endif]-->
                                                                                            </td>
                                                                                        </tr>
                                                                                        </tbody>
                                                                                    </table>
                                                                                    </td>
                                                                                </tr>
                                                                                </tbody>
                                                                            </table>
                                                                            </td>
                                                                        </tr>
                                                                        </tbody>
                                                                    </table>
                                                                    </td>
                                                                </tr>
                                                                </tbody>
                                                            </table>
                                                            </td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</template>

<script>

import {Cloudinary} from "@cloudinary/base";
import {replaceColor} from "@cloudinary/base/actions/adjust";
// Create a Cloudinary instance and set your cloud name.
const cld = new Cloudinary({
    cloud: {
        cloudName: 'pierry'
    }
});

// cld.image returns a CloudinaryImage with the configuration set.

// This returns: https://res.cloudinary.com/demo/image/upload/sample

export default {
    name: "CibPagePreview",
    props: ["layout", "logo", "headline", "intro", "bodyText", "cta", "width", "height", "footer", ],

    data() {
        return {
            headlineFlag: false,
        }
    },

    mounted() {
        this.$nextTick(() => {
            this.headlineFlag = !this.headlineFlag;
        });
    },

    computed: {
        bgImage() {
            let myImage = cld.image(this.layout.empty_public_id);
            return myImage.toURL();
        },


        headlinePrepared() {
            if("string" === typeof this.headline) {
                return this.headline;
            }
            if(null === this.headline) {
                return "";
            }

            const layout = this.layout;

            let assetColor = layout.base_color;
            // if(/^#[0-9a-f]{6}$/i.test(this.color))  {
            //     assetColor = this.color;
            // }

            let primaryColor = layout.headline.c;
            if("asset" === primaryColor) primaryColor = assetColor;

            let secondaryColor = layout.headline.sc;
            if("asset" === secondaryColor) secondaryColor = assetColor;

            const x = this.headline.parts.map(x => {
                return '<span style="color:'+(x.color === "primary" ? primaryColor : secondaryColor)+'">'+x.body+'</span>';
            });
            return x.join('');
        },

        previewSize() {
            const parentWidth = this.width;
            const parentHeight = this.height;
            const parentAspectRatio = parentHeight / parentHeight;

            const layout = this.layout;
            const aspectRatio = layout.size.w / layout.size.h;

            let h, w;
            if(aspectRatio >= parentAspectRatio) {
                w = parentWidth;
                h = parentWidth / aspectRatio;
            } else {
                h = parentHeight;
                w = parentHeight * aspectRatio;
            }

            return {h, w};
        },

        previewMultipliers() {
            const layout = this.layout;

            return {x: this.previewSize.w / layout.size.w, y: this.previewSize.h / layout.size.h};
        },

        headlineClientHeight() {
            const dummy = this.headlineFlag;

            if(this.$refs.headlineDiv) {
                return this.$refs.headlineDiv.clientHeight;
            }
            return 0;
        },

        previewOuterCss() {
            return {
                backgroundImage: 'url(' + this.bgImage + ')',
                height: this.previewSize.h + 'px',
                width: this.previewSize.w + 'px',
            };

        },

        logoAreaCss() {
            const layout = this.layout;
            const m = this.previewMultipliers;
            return {
                left: (layout.logo.x * m.x) + 'px',
                top: (layout.logo.y * m.y) + 'px',

                width: (layout.logo.w * m.x) + 'px',
                height: (layout.logo.h * m.y) + 'px',
            };

        },
        logo2AreaCss() {
            const layout = this.layout;

            if(!layout.logo2) return {display: "none"};

            const m = this.previewMultipliers;
            return {
                left: (layout.logo2.x * m.x) + 'px',
                top: (layout.logo2.y * m.y) + 'px',

                width: (layout.logo2.w * m.x) + 'px',
                height: (layout.logo2.h * m.y) + 'px',
            };

        },

        ctaCss() {
            const layout = this.layout;
            const m = this.previewMultipliers;

            let fontSize = 1.2;
            fontSize *= m.x;

            if(layout.cta.s) {
                fontSize *= layout.cta.s;
            }
            if(this.cta.length >= 24) {
                fontSize *= 0.7;
            } else if(this.cta.length >= 22) {
                fontSize *= 0.8;
            } else if(this.cta.length >= 18) {
                fontSize *= 0.9;
            }

            let assetColor = layout.base_color;
            // if(/^#[0-9a-f]{6}$/i.test(this.color))  {
            //     assetColor = this.color;
            // }
            let ctaColor = layout.cta.c;
            if("asset" === ctaColor) ctaColor = assetColor;


            return {
                left: (layout.cta.l * m.x) + "px",
                right: (layout.cta.r * m.x) + "px",
                top: (layout.cta.y * m.y) + "px",
                height: (layout.cta.h * m.y) + "px",
                color: ctaColor,
                textTransform: "uppercase",
                fontWeight: "bold",
                fontSize: fontSize+"em",
                lineHeight: "1em",
            }

        },

        footerCss() {
            const layout = this.layout;

            if(!layout.footer || !this.footer) return {display: "none"};

            const m = this.previewMultipliers;

            let fontSize = 0.74;
            fontSize *= m.x;

            if(layout.footer.s) {
                fontSize *= layout.footer.s;
            }

            let assetColor = layout.base_color;
            // if(/^#[0-9a-f]{6}$/i.test(this.color))  {
            //     assetColor = this.color;
            // }
            let color = layout.footer.c;
            if("asset" === color) color = assetColor;


            return {
                left: (layout.footer.l * m.x) + "px",
                right: (layout.footer.r * m.x) + "px",
                top: (layout.footer.y * m.y) + "px",
                height: (layout.footer.h * m.y) + "px",
                color,
                fontSize: fontSize+"em",
                lineHeight: "1em",
            }

        },

        headlineCss() {
            const layout = this.layout;
            const m = this.previewMultipliers;

            let fontSize = 3.95;

            fontSize *= m.x;

            if(layout.headline.s) {
                fontSize *= layout.headline.s;
            }

            let lineHeight = 1.05;
            if(layout.headline.lh) {
                lineHeight = layout.headline.lh;
            }

            let fontFamily = "times";
            if(layout.headline.ff) {
                switch(layout.headline.ff) {
                    case "sans-serif":
                        fontFamily = 'SalesforceSansRegular, ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"';
                        break;
                }
            }

            return {
                color: layout.headline.c,
                fontFamily: fontFamily,
                fontSize: fontSize + "em",
                lineHeight: lineHeight + "em",
                left: (layout.headline.l * m.x) + "px",
                right: (layout.headline.r * m.x) + "px",
                top: (layout.headline.y * m.y) + "px",
            }

        },

        introCss() {
            const layout = this.layout;
            const m = this.previewMultipliers;

            let fontSize = 3.95;

            fontSize *= m.x;

            if(layout.intro.s) {
                fontSize *= layout.intro.s;
            }

            let lineHeight = 1.05;
            if(layout.intro.lh) {
                lineHeight = layout.intro.lh;
            }

            let fontFamily = "times";
            if(layout.intro.ff) {
                switch(layout.intro.ff) {
                    case "sans-serif":
                        fontFamily = 'SalesforceSansRegular, ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"';
                        break;
                }
            }

            return {
                color: layout.intro.c,
                fontFamily: fontFamily,
                fontSize: fontSize + "em",
                lineHeight: lineHeight + "em",
                left: (layout.intro.l * m.x) + "px",
                right: (layout.intro.r * m.x) + "px",
                top: (layout.intro.y * m.y) + "px",
            }

        },

        bodyTextCss() {

            const layout = this.layout;
            const m = this.previewMultipliers;

            const dummy = this.headlineFlag;

            let bodyText = {
                display: "none",
            }

            if(layout.bodyText.position !== "none") {
                let bTop;
                if("absolute" === layout.bodyText.position) {
                    bTop = layout.bodyText.y * m.y;
                } else {
                    bTop = (layout.headline.y + layout.bodyText.p) * m.y + this.headlineClientHeight;                    Promise
                }

                let fontSize = 35880.0;
                fontSize *= m.x;
                if(layout.bodyText.s) {
                    fontSize *= layout.bodyText.s;
                }

                if(this.bodyText.length > 40) {
                    fontSize *= 0.85;
                }

                fontSize /= 1000;

                let fontFamily = "times";
                if(layout.bodyText.ff) {
                    switch(layout.bodyText.ff) {
                        case "sans-serif":
                            fontFamily = 'SalesforceSansRegular, ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"';
                            break;
                    }
                }

                let lineHeight = 1.2;
                if(layout.bodyText.lh) {
                    lineHeight = layout.bodyText.lh;
                }

                bodyText = {
                    color: layout.bodyText.c,
                    fontFamily: fontFamily,
                    fontSize: fontSize + "px",
                    lineHeight: lineHeight + "em",
                    left: (layout.bodyText.l * m.x) + "px",
                    right: (layout.bodyText.r * m.x) + "px",
                    top: bTop + "px",
                }
            }

            return bodyText;
        },

    },

    watch: {
        headline(v) {
            this.$nextTick(() => {
                this.headlineFlag = !this.headlineFlag;
            });
        }
    }
}
</script>

<style scoped>
.preview {
    position: relative;
}

.preview-outer {
    position: relative;
    /*padding: 45px 12px 62px 12px;*/
    /*height:100%;*/
    /*width: 100%;*/
    background-repeat: no-repeat;
    background-size: contain;
}

.preview-inner {
    position: relative;
    height:100%;
    width: 100%;
}

/*
.preview-inner .logo-container {
    width: 100%;
    height: 100%;
    text-align: center;
}
*/

.preview-inner  img {
    max-width: 100%;
    max-height: 100%;
    display: inline;
}

.logo-area {
    position:absolute;
    display: flex;
    align-items: flex-start;
    justify-content: left;
}

.logo-area img {
    -webkit-filter: url(#logo_filter);
    filter:  url(#logo_filter);
}

.logo2-area {
    position:absolute;
    display: flex;
    align-items: center;
    justify-content: center;
}

.cta {
    position:absolute;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    z-index: 5;
}

.footer {
    position:absolute;
    display: flex;
    align-items: flex-start;
    justify-content: left;
    z-index: 5;
}

.headline {
    position:absolute;
    /*display: flex;*/
    /*align-items: flex-start;*/
    justify-content: left;
    z-index: 5;
}

.intro {
    position:absolute;
    /*display: flex;*/
    /*align-items: flex-start;*/
    justify-content: left;
    z-index: 5;
}

.body-text {
    position:absolute;
    display: flex;
    align-items: flex-start;
    justify-content: left;
    z-index: 5;
}
</style>